<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zynthora Full FX</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #ff9900;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            touch-action: none;
        }
        h1 { border-bottom: 2px solid #ff9900; padding-bottom: 0.5rem; margin-top: 0; }
        
        .panel {
            background: #222;
            border: 1px solid #444;
            padding: 1.5rem;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            display: grid;
            gap: 1.5rem;
        }
        
        .section-title {
            color: #888;
            font-size: 0.8rem;
            text-align: center;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }

        .control { }
        label { display: block; margin-bottom: 0.5rem; font-size: 0.85rem; }
        
        input[type=range] { width: 100%; accent-color: #ff9900; cursor: pointer; }
        
        .btn-group { display: flex; gap: 5px; justify-content: center; flex-wrap: wrap; }
        button {
            background: #333;
            color: #fff;
            border: 1px solid #666;
            padding: 8px 12px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            flex: 1;
        }
        button.active {
            background: #ff9900;
            color: #000;
            border-color: #ff9900;
        }
        
        .fx-row {
            display: flex;
            gap: 10px;
        }
        
        #status {
            margin-top: 1rem;
            color: #666;
            font-size: 0.8rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>ZYNTHORA FX</h1>
    
    <div class="panel">
        
        <!-- OSCILLATOR -->
        <div>
            <div class="section-title">SOURCE</div>
            <div class="control">
                <div class="btn-group" id="waveforms">
                    <button onclick="setWave('sine', this)">SIN</button>
                    <button onclick="setWave('triangle', this)">TRI</button>
                    <button onclick="setWave('saw', this)" class="active">SAW</button>
                    <button onclick="setWave('square', this)">SQR</button>
                </div>
            </div>
            <div class="control" style="margin-top: 10px;">
                <label>FREQ: <span id="freqVal">440</span> Hz</label>
                <input type="range" id="freq" min="50" max="880" value="440" step="1">
            </div>
            <div class="control">
                <label>DRIVE: <span id="driveVal">0.0</span></label>
                <input type="range" id="drive" min="0" max="1" value="0.0" step="0.01">
            </div>
        </div>

        <!-- FILTER -->
        <div>
            <div class="section-title">FILTER (MOOG)</div>
            <div class="control">
                <label>CUTOFF: <span id="cutVal">20000</span> Hz</label>
                <input type="range" id="cutoff" min="100" max="10000" value="10000" step="10">
            </div>
            <div class="control">
                <label>RESONANCE: <span id="resVal">0.0</span></label>
                <input type="range" id="res" min="0" max="0.95" value="0.0" step="0.01">
            </div>
        </div>

        <!-- EFFECTS -->
        <div>
            <div class="section-title">EFFECTS</div>
            <div class="fx-row">
                <button id="chorusBtn" onclick="toggleChorus()">CHORUS: OFF</button>
                <button id="delayBtn" onclick="toggleDelay()">DELAY: OFF</button>
                <button id="verbBtn" onclick="toggleReverb()" class="active">REVERB: ON</button>
            </div>
            
            <div class="control" style="margin-top: 10px;">
                <label>DELAY TIME: <span id="dtimeVal">0.3</span>s</label>
                <input type="range" id="dtime" min="0.05" max="0.9" value="0.3" step="0.01">
            </div>
            <div class="control">
                <label>DELAY FEEDBACK: <span id="dfeedVal">0.4</span></label>
                <input type="range" id="dfeed" min="0" max="0.9" value="0.4" step="0.01">
            </div>
        </div>
        
        <div id="status">Connecting...</div>
    </div>

    <script>
        const els = {
            freq: document.getElementById('freq'),
            drive: document.getElementById('drive'),
            cutoff: document.getElementById('cutoff'),
            res: document.getElementById('res'),
            dtime: document.getElementById('dtime'),
            dfeed: document.getElementById('dfeed'),
            
            freqVal: document.getElementById('freqVal'),
            driveVal: document.getElementById('driveVal'),
            cutVal: document.getElementById('cutVal'),
            resVal: document.getElementById('resVal'),
            dtimeVal: document.getElementById('dtimeVal'),
            dfeedVal: document.getElementById('dfeedVal'),
            
            status: document.getElementById('status')
        };
        
        let socket;
        function connect() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = protocol + '//' + window.location.host + '/websocket';
            socket = new WebSocket(wsUrl);
            socket.onopen = () => {
                els.status.textContent = "ONLINE";
                els.status.style.color = "#ff9900";
            };
            socket.onclose = () => setTimeout(connect, 2000);
        }

        function send(cmd, val) {
            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(cmd + ":" + val);
            }
        }

        // Bind Sliders
        const bind = (id, cmd) => {
            els[id].addEventListener('input', (e) => {
                els[id + 'Val'].textContent = e.target.value;
                send(cmd, e.target.value);
            });
        };

        bind('freq', 'freq');
        bind('drive', 'drive');
        bind('cutoff', 'cutoff');
        bind('res', 'res');
        bind('dtime', 'dtime');
        bind('dfeed', 'dfeed');

        window.setWave = (type, btn) => {
            document.querySelectorAll('#waveforms button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            send('wave', type);
        };

        let verbOn = true;
        window.toggleReverb = () => {
            verbOn = !verbOn;
            const btn = document.getElementById('verbBtn');
            btn.classList.toggle('active', verbOn);
            btn.textContent = "REVERB: " + (verbOn ? "ON" : "OFF");
            send('reverb', verbOn ? 1 : 0);
        };

        let chorusOn = false;
        window.toggleChorus = () => {
            chorusOn = !chorusOn;
            const btn = document.getElementById('chorusBtn');
            btn.classList.toggle('active', chorusOn);
            btn.textContent = "CHORUS: " + (chorusOn ? "ON" : "OFF");
            send('chorus', chorusOn ? 1 : 0);
        };

        let delayOn = false;
        window.toggleDelay = () => {
            delayOn = !delayOn;
            const btn = document.getElementById('delayBtn');
            btn.classList.toggle('active', delayOn);
            btn.textContent = "DELAY: " + (delayOn ? "ON" : "OFF");
            send('delay', delayOn ? 1 : 0);
        };

        connect();
    </script>
</body>
</html>
